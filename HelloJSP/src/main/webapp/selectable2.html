<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<script src='./dist/index.global.js'></script>
<script>

  document.addEventListener('DOMContentLoaded', async function() {
	  
	  // 값을 담을 변수 선언
	  let eventList = [
		{title: "test",
		 start:"2025-08-09"}  
	  ];
	  
	  // ajax 실행 (비동기 처리)
	  let result = await fetch('eventList.do');
	  let data = await result.json();
	  eventList = data;
	  

		  
		    var calendarEl = document.getElementById('calendar');
		    var calendar = new FullCalendar.Calendar(calendarEl, {
		      headerToolbar: {
		        left: 'prev,next today',
		        center: 'title',
		        right: 'dayGridMonth,timeGridWeek,timeGridDay'
		      },
		      initialDate: new Date(), //'2025-05-12',
		      navLinks: true, // can click day/week names to navigate views
		      selectable: true,
		      selectMirror: true,
		      select: async function(arg) { 
		    	  //console.log(arg); // title, startStr, endStr
		        var title = prompt('일정을 등록하세요:');
		        if (title) {
		        	let resolve = await fetch('addEvent.do?title=' + title + '&start=' + arg.startStr +'&end=' + arg.endStr);
		            let result = await resolve.json();
		        	
		        		if(result.retCode == "OK")
	        			{
				        	//캘린더에 일정을 추가.
				          calendar.addEvent({
				            title: title,
				            start: arg.start,
				            end: arg.end,
				            allDay: arg.allDay
				          }) // 일정 추가.
	        			}else if(result.retCode == "NG")
        				{
        					alert('에러가 발생.');
        				}else
       					{
       						alert('알 수 없는 예외.');
       					}

		        }
		        calendar.unselect()
		      },
		      eventClick: async function(arg)
		      {
		    	  let resolve = await fetch('deleteEvent.do?eventNo=' + arg.event.id);
		    	  let result = await resolve.json();
		    	  //console.log(arg); title => arg.event.title
		        if (confirm('해당 일정을 삭제하시겠습니까?'))
		        {
		    	  		if(result.retCode == "OK")
	    	  			{
			        		arg.event.remove()
	    	  			}else if(result.retCode == "NG")
        				{
        					alert('삭제 실패.');
        				}else
       					{
       						alert('알 수 없는 에러코드.');
       					}
		    	  }

		      },
		      editable: true,
		      dayMaxEvents: true, // allow "more" link when too many events
		      events: eventList
		    });
		
		    calendar.render();

  });

</script>
<style>

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 1100px;
    margin: 0 auto;
  }

</style>
</head>
<body>

  <div id='calendar'></div>

</body>
</html>
